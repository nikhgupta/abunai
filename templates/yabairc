#!/usr/bin/env sh

# the scripting-addition must be loaded manually if
# you are running yabai on macOS Big Sur.
#
# NOTE: For this to work you must configure sudo such that
# it will be able to run the command without password
yabai -m signal --add event=dock_did_restart action="sudo yabai --load-sa"

# create debug logs
yabai -m config debug_output %{debug}

#########################################################################
# LAYOUT                                                                #
#########################################################################

# layout based on user defined preference
yabai -m config layout %{layout}

# do not equalize size of children and parents
yabai -m config auto_balance off

# ratio for child splits
yabai -m config split_ratio 0.5

# split to right and down
yabai -m config window_placement second_child

# floating windows are always on top
yabai -m config window_topmost off

# no padding between screen edges and windows
yabai -m config top_padding 0
yabai -m config bottom_padding 0
yabai -m config left_padding 0
yabai -m config right_padding 0

# padding of 20 pixels between different windows
yabai -m config window_gap 6

#########################################################################
# MOUSE SUPPORT                                                         #
#########################################################################

# set mouse interaction modifier key (default: fn)
yabai -m config mouse_modifier fn

# make focus and mouse follow each other
yabai -m config mouse_follows_focus off
yabai -m config focus_follows_mouse off

# move and resize windows using mouse
yabai -m config mouse_action1 move
yabai -m config mouse_action2 resize
yabai -m config mouse_drop_action swap

#########################################################################
# WINDOWS APPEARANCE                                                    #
#########################################################################

# show shadows for floating windows only
yabai -m config window_shadow float

# render all unfocus windows with 0.98 opacity
yabai -m config window_opacity off
yabai -m config active_window_opacity 1.0
yabai -m config normal_window_opacity 0.98

# borders
yabai -m config window_border on
yabai -m config window_border_width 0
yabai -m config insert_feedback_color %{colors.feedback}
yabai -m config normal_window_border_color %{colors.normal_window_border}
yabai -m config active_window_border_color %{colors.active_window_border}

#########################################################################
# Abunai
#########################################################################
abunai yabai update_spaces

# rules generated by abunai
%{rules}

# signals added by abunai
# following signals auto-update your spaces when external displays are connected/disconnected
%{signals}

# yabai signals
yabai -m signal --add event=window_destroyed action="yabai -m query --windows --window &> /dev/null || yabai -m window --focus mouse"
yabai -m signal --add event=application_terminated action="yabai -m query --windows --window &> /dev/null || yabai -m window --focus mouse"

test -f ~/.yabairc.local && source ~/.yabairc.local
echo "yabai configuration loaded.."
